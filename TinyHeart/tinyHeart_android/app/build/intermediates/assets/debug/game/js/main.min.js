var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,r){function o(e){try{g(n.next(e))}catch(t){r(t)}}function s(e){try{g(n["throw"](e))}catch(t){r(t)}}function g(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(o,s)}g((n=n.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return n([e,t])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;g;)try{if(a=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,r=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(o=g.trys,!(o=o.length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){g.label=i[1];break}if(6===i[0]&&g.label<o[1]){g.label=o[1],o=i;break}if(o&&g.label<o[2]){g.label=o[2],g.ops.push(i);break}o[2]&&g.ops.pop(),g.trys.pop();continue}i=t.call(e,g)}catch(n){i=[6,n],r=0}finally{a=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,r,o,s,g={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function n(n){t.call(i,n,e)}if(RES.hasRes(e)){var a=RES.getRes(e);a?n(a):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),TinyHeart.GameScene.main=this,egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),[3,5];case 4:return t=i.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var n=new eui.Theme("resource/default.thm.json",e.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){this.addChild(fairygui.GRoot.inst.displayObject);var e=new TinyHeart.PlayGame;Utils.enterScene(e)},t.prototype.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},t}(eui.UILayer);__reflect(Main.prototype,"Main");var TinyHeart;!function(e){var t=function(){function t(){fairygui.UIPackage.addPackage("TinyHeart"),this._view=fairygui.UIPackage.createObject("TinyHeart","Play").asCom,this._view.setSize(fairygui.GRoot.inst.width,fairygui.GRoot.inst.height),this._view.enabled=!0,this._view.addClickListener(function(){var t=new e.GameScene;Utils.enterScene(t)},this)}return t.prototype.getView=function(){return this._view},t}();e.PlayGame=t,__reflect(t.prototype,"TinyHeart.PlayGame");var i=function(){function t(){this.fishX=[],this._anys=[],this.anyY=[],fairygui.UIPackage.addPackage("TinyHeart"),this._view=fairygui.UIPackage.createObject("TinyHeart","Main").asCom,this._view.setSize(fairygui.GRoot.inst.width,fairygui.GRoot.inst.height),this.initFish(),this.initAny(),this.initFruit();var e=new egret.Timer(300,0);e.addEventListener(egret.TimerEvent.TIMER,this.initFruit,this),e.start(),this.gameTxt=this._view.getChild("txt").asTextField}return t.prototype.getView=function(){return this._view},t.prototype.initAny=function(){for(var e=50,t=0;e>t;t++){var i=new fairygui.GGraph;i.setSize(16,200),i.drawRect(0,4095,0,3872078,.6,[16,16,16,16]),i.height=150+50*Math.random(),i.x=16*t+20*Math.random(),i.y=fairygui.GRoot.inst.height-i.height+50,this._anys.push(i),this.anyY.push(i.y)}for(var t=0;e>t;t++)this._view.addChild(this._anys[t])},t.prototype.initFruit=function(){var t=this,i=Math.floor(50*Math.random()),n=this,a=Utils.createBitmapByName("fruit");a.width=16,a.height=16,a.scaleX=0,a.scaleY=0,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=16*i+20*Math.random(),a.y=this.anyY[i],e.GameScene.main.addChild(a);var r=(egret.Tween.get(a,{onChange:function(){if(1===a.scaleX){egret.Tween.get(a,{onChange:function(){a.y<=0&&e.GameScene.main.removeChild(a)},onChangeObj:a}).to({y:0},5e3*Math.random()+2e3)}},onChangeObj:a}).to({scaleX:1,scaleY:1},1e3),0),o=3,s=new egret.Timer(10,0);s.addEventListener(egret.TimerEvent.TIMER,function(){r+=1,r>=100*o&&(t.initBlue(),r=0);var e=new egret.Rectangle(a.x,a.y,a.width,a.height),i=new egret.Rectangle(n._fish.x,n._fish.y,n._fish.width,n._fish.height),g=e.intersects(i);a.y<=5&&s.stop();var c=parseFloat(t.gameTxt.text);if(g){a.visible=!1,t._fish.getChild("eye").asButton.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEye1"),50>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat0"):100>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat1"):500>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat2"):1e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat3"):2e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat4"):5e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat5"):8e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat6"):1e4>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat7"):t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEat7");var u=new egret.Timer(100,1);u.addEventListener(egret.TimerEvent.TIMER,function(){t._fish.getChild("eye").asButton.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEye0"),50>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim0"):100>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim1"):500>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim2"):1e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim3"):2e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim4"):5e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim5"):8e3>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim6"):1e4>c?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim7"):t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim7")},t),s.stop(),u.start(),t.gameTxt.text=""+(c+=10)}},this),s.start()},t.prototype.initBlue=function(){var t=this,i=Math.floor(50*Math.random()),n=this,a=Utils.createBitmapByName("blue");a.width=16,a.height=16,a.scaleX=0,a.scaleY=0,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=16*i+20*Math.random(),a.y=this.anyY[i],e.GameScene.main.addChild(a);var r=(egret.Tween.get(a,{onChange:function(){if(1===a.scaleX){egret.Tween.get(a,{onChange:function(){a.y<=0&&e.GameScene.main.removeChild(a)},onChangeObj:a}).to({y:0},5e3*Math.random()+2e3)}},onChangeObj:a}).to({scaleX:1,scaleY:1},1e3),new egret.Timer(10,0));r.addEventListener(egret.TimerEvent.TIMER,function(){var e=new egret.Rectangle(a.x,a.y,a.width,a.height),i=new egret.Rectangle(n._fish.x,n._fish.y,n._fish.width,n._fish.height),o=e.intersects(i);a.y<=5&&r.stop();var s=parseFloat(t.gameTxt.text);if(o){a.visible=!1,t._fish.getChild("eye").asButton.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEye1"),50>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue0"):100>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue1"):500>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue2"):1e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue3"):2e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue4"):5e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue5"):8e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue6"):1e4>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue7"):t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEatBlue7");var g=new egret.Timer(100,1);g.addEventListener(egret.TimerEvent.TIMER,function(){t._fish.getChild("eye").asButton.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEye0"),50>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue0"):100>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue1"):500>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue2"):1e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue3"):2e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue4"):5e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue5"):8e3>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue6"):1e4>s?t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue7"):t._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwimBlue7")},t),r.stop(),g.start(),t.gameTxt.text=""+(s-=50)}},this),r.start()},t.prototype.initFish=function(){var e=this;this._fish=this._view.getChild("fish").asButton,this._fish.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigSwim0"),this._fish.getChild("eye").asButton.icon=fairygui.UIPackage.getItemURL("TinyHeart","bigEye0"),this._fish.draggable=!0,this._fish.dragBounds=new egret.Rectangle(0,0,fairygui.GRoot.inst.width-15,fairygui.GRoot.inst.height);var t=new egret.Timer(200,1);this._fish.addEventListener(fairygui.DragEvent.DRAG_MOVING,function(i){e.fishX.push(i.stageX);var n=e.fishX.length;n>100&&e.fishX.splice(0,50),t.addEventListener(egret.TimerEvent.TIMER,function(){if(n>2){var t=e.fishX[n-2],i=e.fishX[n-1];t>i?e._fish.scaleX=1:e._fish.scaleX=-1}},e),t.start()},this)},t.prototype.fruitMonitor=function(){},t}();e.GameScene=i,__reflect(i.prototype,"TinyHeart.GameScene");var n=function(e){function t(){var t=e.call(this)||this;return t.drawAny(),t}return __extends(t,e),t.prototype.drawAny=function(){this.graphics.beginFill(8656251),this.graphics.drawRect(0,0,50,50),this.graphics.endFill()},t}(egret.Shape);e.Ane=n,__reflect(n.prototype,"TinyHeart.Ane")}(TinyHeart||(TinyHeart={}));var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,n){function a(e){t.call(n,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}"undefined"!=typeof generateEUI?egret.callLater(function(){t.call(n,generateEUI)},this):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_TEXT))},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Utils=function(){function e(){}return e.enterScene=function(e){var t=fairygui.GRoot.inst.nativeStage.numChildren;fairygui.GRoot.inst.removeChildren(0,t,!0),e.getView&&fairygui.GRoot.inst.addChild(e.getView())},e.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e}();__reflect(Utils.prototype,"Utils");